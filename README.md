# ğŸš— Automotive CAN Shared Memory System

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)](https://github.com/beerboy/automotive-can-shared-memory)
[![Language: C](https://img.shields.io/badge/language-C99-blue.svg)](https://en.wikipedia.org/wiki/C99)
[![Platform: Linux](https://img.shields.io/badge/platform-Linux-lightgrey.svg)](https://www.linux.org/)

é«˜æ€§èƒ½è»Šè¼‰CANãƒ‡ãƒ¼ã‚¿å…±æœ‰ãƒ¡ãƒ¢ãƒªã‚·ã‚¹ãƒ†ãƒ  - **ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°æ³•å®Ÿè£…**

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

è»Šä¸¡ECUã‹ã‚‰å–å¾—ã—ãŸCANãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ãƒ—ãƒ­ã‚»ã‚¹é–“ã§é«˜é€Ÿãƒ»å®‰å…¨ã«å…±æœ‰ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚å¾“æ¥ã®ãƒãƒƒã‚·ãƒ¥è¡çªã«ã‚ˆã‚‹ä¸Šæ›¸ãæ–¹å¼ã®è‡´å‘½çš„ãªå•é¡Œã‚’è§£æ±ºã—ã€**ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°æ³•**ã«ã‚ˆã‚Š**ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¹å®Œå…¨é˜²æ­¢**ã¨**ãƒã‚¤ã‚¯ãƒ­ç§’ãƒ¬ãƒ™ãƒ«ã®ä½é…å»¶**ã‚’å®Ÿç¾ã€‚

### âš¡ ä¸»ãªç‰¹å¾´

- **ğŸ”’ ãƒ‡ãƒ¼ã‚¿ä¿å…¨æ€§**: ãƒãƒƒã‚·ãƒ¥è¡çªæ™‚ã‚‚ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¹å®Œå…¨é˜²æ­¢
- **âš¡ é«˜æ€§èƒ½**: Set < 1Î¼s, Get < 500ns (ç›®æ¨™å€¤)
- **ğŸ§µ ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•**: seqlockã«ã‚ˆã‚‹å®‰å…¨ãªä¸¦è¡Œã‚¢ã‚¯ã‚»ã‚¹
- **ğŸ“Š ç›£è¦–æ©Ÿèƒ½**: è©³ç´°ãªãƒãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«çµ±è¨ˆæƒ…å ±
- **ğŸš— è»Šè¼‰æœ€é©åŒ–**: MISRA Cæº–æ‹ ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¦æ±‚å¯¾å¿œ

## ğŸš¨ è§£æ±ºã™ã‚‹å•é¡Œ

### å¾“æ¥æ–¹å¼ã®è‡´å‘½çš„ãªå•é¡Œ
```c
// âŒ å¾“æ¥ã®ä¸Šæ›¸ãæ–¹å¼
CAN ID 0x123    â†’ ãƒãƒƒã‚·ãƒ¥è¡çª â†’ ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¹
CAN ID 0x456ABC â†’ ä¸Šæ›¸ã       â†’ 0x123ãŒæ¶ˆå¤±
```

### âœ… ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°æ³•ã«ã‚ˆã‚‹è§£æ±º
```c
// âœ… ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°æ³•
CAN ID 0x123    â†’ ãƒã‚±ãƒƒãƒˆ[100] â†’ å®‰å…¨ã«æ ¼ç´
CAN ID 0x456ABC â†’ ãƒã‚±ãƒƒãƒˆ[101] â†’ ä¸¡æ–¹ã¨ã‚‚ä¿å­˜
```

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Process A     â”‚    â”‚   Process B     â”‚    â”‚   Process C     â”‚
â”‚   (CAN Driver)  â”‚    â”‚   (App 1)       â”‚    â”‚   (App 2)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Set() API     â”‚    â”‚ Get/Subscribe() â”‚    â”‚ Get/Subscribe() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Shared Memory Layout   â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚ Global Header       â”‚  â”‚
                    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                    â”‚  â”‚ Hash Table (8192)   â”‚  â”‚
                    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
                    â”‚  â”‚ â”‚ Linear Probing  â”‚ â”‚  â”‚
                    â”‚  â”‚ â”‚ Collision-Safe  â”‚ â”‚  â”‚
                    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ãƒ“ãƒ«ãƒ‰ & ãƒ†ã‚¹ãƒˆ (è‡ªå‹•)

```bash
# ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆ
./build_and_test.sh

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®š
./build_and_test.sh --clean --debug    # ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰ (ãƒ‡ãƒãƒƒã‚°)
./build_and_test.sh --no-performance   # æ€§èƒ½ãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—
```

### 2. æ‰‹å‹•ãƒ“ãƒ«ãƒ‰

```bash
mkdir build_linear_probing && cd build_linear_probing
cmake -DCMAKE_BUILD_TYPE=Release -f ../CMakeLists_linear_probing.txt ..
make -j$(nproc)

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make run_tests        # åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
make run_demo         # ãƒãƒƒã‚·ãƒ¥è¡çªãƒ‡ãƒ¢
make run_performance  # æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
```

### 3. ä½¿ç”¨ä¾‹

```c
#include "can_shm_api.h"
#include "can_shm_linear_probing.h"

int main() {
    // å…±æœ‰ãƒ¡ãƒ¢ãƒªåˆæœŸåŒ–
    can_shm_init();
    
    // ãƒ‡ãƒ¼ã‚¿è¨­å®š (ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°)
    uint32_t can_id = 0x123;
    uint8_t data[] = {0x01, 0x02, 0x03, 0x04};
    can_shm_set_linear_probing(can_id, 4, data);
    
    // ãƒ‡ãƒ¼ã‚¿å–å¾—
    CANData retrieved_data;
    can_shm_get_linear_probing(can_id, &retrieved_data);
    
    // çµ±è¨ˆæƒ…å ±è¡¨ç¤º
    can_shm_print_hash_stats();
    
    can_shm_cleanup();
    return 0;
}
```

## ğŸ“Š æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

| æ“ä½œ | å¾“æ¥æ–¹å¼ | ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°æ³• | æ”¹å–„ç‡ |
|------|---------|-------------------|--------|
| **Setæ“ä½œ** | ~1Î¼s | ~1Î¼s | åŒç­‰ |
| **Getæ“ä½œ** | ~500ns | ~500ns | åŒç­‰ |
| **ãƒ‡ãƒ¼ã‚¿ä¿å…¨æ€§** | âŒ è¡çªã§ãƒ­ã‚¹ | âœ… å®Œå…¨ä¿è­· | âˆ |
| **æ¢æŸ»å›æ•°** | 1å› | å¹³å‡2å› (50%è² è·) | è¨±å®¹ç¯„å›² |

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
automotive-can-shared-memory/
â”œâ”€â”€ ğŸ”§ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ can_shm_types.h              # å…±é€šå‹å®šç¾©
â”‚   â”œâ”€â”€ can_shm_api.h/.c            # å…ƒå®Ÿè£… (å‚è€ƒç”¨)
â”‚   â””â”€â”€ can_shm_linear_probing.h/.c # ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°å®Ÿè£…
â”œâ”€â”€ ğŸ§ª ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_can_shm.c              # å…ƒã®ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ test_linear_probing.c       # æ–°å®Ÿè£…ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ ğŸ—ï¸ ãƒ“ãƒ«ãƒ‰è¨­å®š
â”‚   â”œâ”€â”€ CMakeLists_linear_probing.txt
â”‚   â”œâ”€â”€ build_and_test.sh           # è‡ªå‹•ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ Makefile_linear_probing
â””â”€â”€ ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ DESIGN_SPECIFICATION.md     # è©³ç´°è¨­è¨ˆä»•æ§˜
    â”œâ”€â”€ HASH_COLLISION_ANALYSIS.md  # æŠ€è¡“åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
    â”œâ”€â”€ README_LINEAR_PROBING.md    # å®Ÿè£…ã‚¬ã‚¤ãƒ‰
    â””â”€â”€ REQUIREMENT.md              # è¦æ±‚ä»•æ§˜
```

## ğŸ”¬ ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

### 1. åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
```bash
./test_linear_probing
```
- Set/Getæ“ä½œã®æ­£å¸¸å‹•ä½œ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèª

### 2. ãƒãƒƒã‚·ãƒ¥è¡çªãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```bash
./demo_collision_comparison
```
- æ„å›³çš„ãªè¡çªç™ºç”Ÿ
- ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°ã«ã‚ˆã‚‹è§£æ±ºéç¨‹
- å¾“æ¥æ–¹å¼ã¨ã®æ¯”è¼ƒ

### 3. æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
```bash
./performance_test
```
- å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã®å‡¦ç†é€Ÿåº¦æ¸¬å®š
- è² è·ç‡åˆ¥ã®æ€§èƒ½ç‰¹æ€§
- è©³ç´°çµ±è¨ˆæƒ…å ±

## ğŸ¯ æŠ€è¡“çš„ãƒã‚¤ãƒ©ã‚¤ãƒˆ

### ãƒãƒƒã‚·ãƒ¥è¡çªè§£æ±ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
```c
// ãƒªãƒ‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°å®Ÿè£…ä¾‹
for (int i = 0; i < MAX_ENTRIES; i++) {
    uint32_t idx = (initial_hash + i) % MAX_ENTRIES;
    
    if (bucket[idx].is_valid == 0) {
        // ç©ºããƒã‚±ãƒƒãƒˆç™ºè¦‹ â†’ æ ¼ç´
        store_data(bucket[idx], can_id, data);
        return SUCCESS;
    } else if (bucket[idx].can_id == can_id) {
        // åŒã˜CAN ID â†’ æ›´æ–°
        update_data(bucket[idx], data);
        return SUCCESS;
    }
    // åˆ¥ã®CAN IDãŒä½¿ç”¨ä¸­ â†’ æ¬¡ã®ãƒã‚±ãƒƒãƒˆã¸
}
```

### seqlockã«ã‚ˆã‚‹ä¸¦è¡Œåˆ¶å¾¡
```c
// æ›¸ãè¾¼ã¿æ™‚ (Setæ“ä½œ)
seq = bucket->sequence + 1;              // å¥‡æ•°åŒ–
__atomic_store_n(&bucket->sequence, seq, __ATOMIC_RELEASE);
/* ãƒ‡ãƒ¼ã‚¿æ›´æ–° */
__atomic_store_n(&bucket->sequence, seq + 1, __ATOMIC_RELEASE); // å¶æ•°åŒ–

// èª­ã¿å–ã‚Šæ™‚ (Getæ“ä½œ) - ãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼
do {
    seq1 = __atomic_load_n(&bucket->sequence, __ATOMIC_ACQUIRE);
    if (seq1 & 1) continue;  // æ›¸ãè¾¼ã¿ä¸­ã¯ãƒªãƒˆãƒ©ã‚¤
    data = bucket->data;     // ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼
    seq2 = __atomic_load_n(&bucket->sequence, __ATOMIC_RELAXED);
} while (seq1 != seq2);      // ä¸æ•´åˆæ™‚ã¯ãƒªãƒˆãƒ©ã‚¤
```

## ğŸš— è»Šè¼‰ã‚·ã‚¹ãƒ†ãƒ é©åˆæ€§

### MISRA C æº–æ‹ 
- âœ… å‹•çš„ãƒ¡ãƒ¢ãƒªç¢ºä¿ç¦æ­¢
- âœ… ä¾‹å¤–å‡¦ç†ç¦æ­¢
- âœ… RTTIä½¿ç”¨ç¦æ­¢
- âœ… æ±ºå®šè«–çš„å®Ÿè¡Œæ™‚é–“

### ISO 26262 å¯¾å¿œ
- âœ… äºˆæ¸¬å¯èƒ½ãªãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- âœ… æœ€å¤§å®Ÿè¡Œæ™‚é–“ã®è¨ˆç®—å¯èƒ½æ€§
- âœ… æ•…éšœæ¤œå‡ºæ©Ÿèƒ½
- âœ… è©³ç´°ãªçµ±è¨ˆç›£è¦–

## ğŸ“ˆ çµ±è¨ˆç›£è¦–æ©Ÿèƒ½

```c
can_shm_print_hash_stats();
```

å‡ºåŠ›ä¾‹ï¼š
```
=== Hash Table Statistics (Linear Probing) ===
Current Entries: 2048 / 8192
Load Factor: 25.00%
Total Probes: 2150
Collision Count: 102
Max Probe Distance: 3
Average Probe Distance: 1.05
Total Operations: Set=2048, Get=10240
===============================================
```

## ğŸ› ï¸ è¦æ±‚ç’°å¢ƒ

### å¿…é ˆ
- Linux (POSIXå…±æœ‰ãƒ¡ãƒ¢ãƒªå¯¾å¿œ)
- GCC (C99å¯¾å¿œ)
- CMake 3.10+
- pthread library
- librt (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ‹¡å¼µ)

### æ¨å¥¨
- 4GB+ RAM
- ãƒãƒ«ãƒã‚³ã‚¢ CPU
- SSD ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ

1. ãƒ•ã‚©ãƒ¼ã‚¯ä½œæˆ
2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒä½œæˆ (`git checkout -b feature/amazing-feature`)
3. ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add amazing feature'`)
4. ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è©³ç´°ã¯ [LICENSE](LICENSE) ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- [æŠ€è¡“åˆ†æãƒ¬ãƒãƒ¼ãƒˆ](HASH_COLLISION_ANALYSIS.md)
- [è©³ç´°è¨­è¨ˆä»•æ§˜æ›¸](DESIGN_SPECIFICATION.md)
- [å®Ÿè£…ã‚¬ã‚¤ãƒ‰](README_LINEAR_PROBING.md)
- [CAN Bus è¦æ ¼](https://en.wikipedia.org/wiki/CAN_bus)
- [ISO 26262 (è»Šè¼‰å®‰å…¨è¦æ ¼)](https://en.wikipedia.org/wiki/ISO_26262)

## ğŸ·ï¸ ã‚¿ã‚°

`automotive` `embedded` `can-bus` `shared-memory` `hash-table` `linear-probing` `real-time` `high-performance` `collision-resolution` `vehicle-ecu`

---

**é–‹ç™ºè€…**: Claude Code  
**æ›´æ–°æ—¥**: 2025-07-03  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0